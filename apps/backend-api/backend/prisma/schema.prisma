generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

/* =========================
   PRODUCT
========================= */
model Product {
  id          String   @id @default(cuid())
  name        String
  price       Int
  description String
  coverImage  String
  freeShip    Boolean  @default(false)
  createdAt   DateTime @default(now())
}

/* =========================
   CONVERSATION (LEAD)
========================= */
model Conversation {
  id          String      @id @default(cuid())
  psid        String      @unique
  phone       String?
  status      LeadStatus  @default(NEW)
  lastMessage String?
  messages    Message[]

  updatedAt   DateTime    @updatedAt
  createdAt   DateTime    @default(now())

  @@index([status])
  @@index([updatedAt])
}

/* =========================
   MESSAGE
========================= */
model Message {
  id             String        @id @default(cuid())
  conversationId String
  sender         MessageSender
  content        String
  intent         MessageIntent @default(UNKNOWN)
  createdAt      DateTime      @default(now())

  conversation Conversation @relation(fields: [conversationId], references: [id])

  @@index([conversationId])
  @@index([createdAt])
}

/* =========================
   ENUMS
========================= */
enum LeadStatus {
  NEW        // mới nhắn
  INTEREST  // hỏi giá / sản phẩm
  HOT       // đã để SĐT
  DONE      // sale xử lý xong
}

enum MessageSender {
  USER
  BOT
}

enum MessageIntent {
  ASK_PRICE
  ASK_SHIP
  ASK_PRODUCT
  LEAVE_PHONE
  CHITCHAT
  UNKNOWN
}
